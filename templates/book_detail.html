<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8">
    <title>{{ book[1] }} - Details</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    {% include '_sidebar.html' %}
    
    <div class="action-links">
        <a href="{{ url_for('base.index') }}" class="details-back-to-list-link">Back to Catalog</a>   
    </div>
    <div class="container">
        <h1>{{ book[1] }}</h1> <!-- Book Title -->
        <div class="book-detail-header">
            <!-- Book Cover Image -->
            <div class="book-cover">
                {% if book.cover_image_url %}
                    <img src="{{ url_for('static', filename=book['cover_image_url']) }}" alt="Book Image" width="250">
                {% else %}
                    <p>No Image Available</p>
                {% endif %}
            </div>
        
            <!-- Book Details -->
            <div class="book-info">
                <p><strong>Author:</strong> {{ book['author'] }}</p>
                <p><strong>Publisher:</strong> {{ book['publisher'] }}</p>
                <p><strong>Year:</strong> {{ book['publish_year'] }}</p>
                <p><strong>Pages:</strong> {{ book['page_count'] }}</p>
                <p><strong>ISBN:</strong> {{ book['isbn'] }}</p>
                <p><strong>Book Description:</strong></p>

                <div class="description-container">
                    <span class="description-text" id="description">{{ book['description'] }}</span>
                    <button type="button" class="toggle-button" onclick="toggleDescription()">View More</button>
                </div>
            </div>
        </div>
            <!---edit/delete buttons-->
    <a href="/books/edit/{{ book[0] }}" class="edit-link">Edit</a>
    <a href="/books/delete/{{ book[0] }}" onclick="return confirm('Are you sure?')" class="delete-link">Delete</a>
    </div>

    <!-- Section for Rating and Review -->
    <div class="container">
        <!-- Collection Selection -->
        <h2>{{ current_user.username.capitalize() }}'s Book Stats</h2>
        <form action="{{ url_for('collections.add_to_collection') }}" method="post">
            <input type="hidden" name="id" value="{{ book['id'] }}">
            <label for="status">Status:</label>
            <select name="status" id="status" class="select-collection">
                <option value="untracked" {% if collection_status == "untracked" %}selected{% endif %}>Untracked</option>
                <option value="read" {% if collection_status == "read" %}selected{% endif %}>Read</option>
                <option value="want to read" {% if collection_status == "want to read" %}selected{% endif %}>Want to Read</option>
                <option value="currently reading" {% if collection_status == "currently reading" %}selected{% endif %}>Currently Reading</option>
            </select>            
            <button type="submit" id="add-to-collection">Add to Collection</button>
        </form>

        {% if read_data %}
            <p><strong>Date Read:</strong> {{ read_data['date_read'] }}</p>
            <p><strong>Rating:</strong> {{ read_data['rating'] }} / 5</p>
            <p><strong>Review:</strong> {{ read_data['comment'] }}</p>
        {% else %}
            <p>No review added yet.</p>
        {% endif %}    

        <a href="{{ url_for('read.rate_review', book_id=book.id) }}" id="review-link">Edit or Leave a Review</a>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
