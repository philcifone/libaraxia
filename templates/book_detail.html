<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8">
    <title>{{ book[1] }} - Details</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
</head>
<body>
    {% include '_sidebar.html' %}

    <div class="container">
        <h1>{{ book[1] }}</h1> <!-- Book Title -->
        <div class="book-detail-header">
            <!-- Book Cover Image -->
            <div class="book-cover">
                {% if book.cover_image_url %}
                    <img src="{{ url_for('static', filename=book['cover_image_url']) }}" alt="Book Image" width="250">
                {% else %}
                    <p>No Image Available</p>
                {% endif %}
            </div>
        
            <!-- Book Details -->
            <article class="book-info">
                <p><strong>Author:</strong> {{ book['author'] }}</p>
                <p><strong>Publisher:</strong> {{ book['publisher'] }}</p>
                <p><strong>Year:</strong> {{ book['publish_year'] }}</p>
                <p><strong>Pages:</strong> {{ book['page_count'] }}</p>
                <p><strong>ISBN:</strong> {{ book['isbn'] }}</p>
                <p><strong>Book Description:</strong></p>

                <div class="description-container">
                    <span class="description-text" id="description">{{ book['description'] }}</span>
                    <button type="button" class="toggle-button" onclick="toggleDescription()">View More</button>
                </div>
            </article>
        </div>
            <!---edit/delete buttons-->
            <div class="action-buttons">
                <a href="/books/edit/{{ book[0] }}" class="edit-link">Edit</a>
                <a href="/books/delete/{{ book[0] }}" onclick="return confirm('This will remove the book from the database. Are you sure?')" class="delete-link">Delete</a>
            </div>
    </div>

    <!-- Section for Rating and Review -->
    <div class="review-container">
        <h2 class="stats-header">{{ current_user.username.capitalize() }}'s Reading Journey for {{ book[1] }}</h2>
        
        <div class="reading-status-card">
            <form action="{{ url_for('collections.add_to_collection') }}" method="post" class="status-form">
                <input type="hidden" name="id" value="{{ book['id'] }}">
                <div class="status-group">
                    <label for="status" class="status-label">Reading Status</label>
                    <select name="status" id="status" class="status-select">
                        <option value="untracked" {% if collection_status == "untracked" %}selected{% endif %}>Untracked</option>
                        <option value="read" {% if collection_status == "read" %}selected{% endif %}>Read</option>
                        <option value="want to read" {% if collection_status == "want to read" %}selected{% endif %}>Want to Read</option>
                        <option value="currently reading" {% if collection_status == "currently reading" %}selected{% endif %}>Currently Reading</option>
                    </select>
                    <button type="submit" class="status-update-btn">Update Status</button>
                </div>
            </form>
        </div>
    
        <div class="reading-stats-card">
            {% if read_data %}
                <div class="stats-grid">
                    <div class="stats-item">
                        <span class="stats-label">Date Read</span>
                        <span class="stats-value">{{ read_data['date_read'] }}</span>
                    </div>
                    <div class="stats-item">
                        <span class="stats-label">Your Rating</span>
                        <div class="rating-display">
                            <span class="stats-value">{{ read_data['rating'] }} / 5</span>
                            <div class="stars-display">
                                {% for i in range(read_data['rating']|int) %}
                                    <span class="star filled">★</span>
                                {% endfor %}
                                {% for i in range(5 - read_data['rating']|int) %}
                                    <span class="star">☆</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% if read_data['comment'] %}
                        <div class="stats-item full-width">
                            <span class="stats-label">Your Review</span>
                            <p class="review-text">{{ read_data['comment'] }}</p>
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <p class="no-review">No review added yet.</p>
            {% endif %}
            
            <div class="review-actions">
                <a href="{{ url_for('read.rate_review', book_id=book.id) }}" class="review-btn">
                    {% if read_data %}Edit{% else %}Write a{% endif %} Review
                </a>
            </div>
        </div>
    </div>

    <div class="back-to-list">
        <a href="{{ url_for('base.index') }}" class="back-to-list-link">Back to Catalog</a>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
