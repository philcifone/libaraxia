<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8">
    <title>Add Book</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
    <!-- Add QuaggaJS for barcode scanning -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
    {% include '_sidebar.html' %}
    
    <div class="search-form-container">
        <!-- Add tabs for different search methods -->
        <div class="search-methods">
            <button class="search-method-btn active" data-method="search">Search Title/Author</button>
            <button class="search-method-btn" data-method="isbn">ISBN Lookup</button>
            <button class="search-method-btn" data-method="barcode">Scan Barcode</button>
        </div>

        <!-- Title/Author Search Section -->
        <div id="search-section" class="search-method-content active">
            <form class="search-bar">
                <input 
                    type="text" 
                    id="book-search" 
                    placeholder="Search by title or author..."
                >
                <button type="button" id="search-btn">Search</button>
            </form>
            <!-- Search Results Container -->
            <div id="search-results" class="search-results-grid"></div>
        </div>

        <!-- ISBN Lookup Section -->
        <div id="isbn-section" class="search-method-content">
            <form method="POST" enctype="multipart/form-data" class="search-bar">
                <input 
                    type="text" 
                    id="isbn_lookup" 
                    name="isbn" 
                    placeholder="Enter ISBN to fetch book info"
                    value="{{ book_details.isbn if book_details }}"
                >
                <button type="submit" name="isbn_lookup" id="isbn-fetch">Fetch Details</button>
            </form>
        </div>

        <!-- Barcode Scanner Section -->
        <div id="barcode-section" class="search-method-content">
            <div class="barcode-container">
                <div id="interactive" class="viewport"></div>
                <button id="toggle-scanner" class="scanner-btn">Start Scanner</button>
            </div>
        </div>
    </div>

    <div class="container">
        <a href="{{ url_for('base.index') }}" class="back-nav" id="ratepagelistlink">
            <span class="back-arrow">‚Üê</span>
            <span>Back to Catalog</span>
        </a>
        
        <!-- Book Form (will be populated by search/scan results) -->
        <form method="POST" enctype="multipart/form-data" class="book-info-form">
            {% if book_details and book_details.source %}
            <div class="api-source">Data source: {{ book_details.source }}</div>
            {% endif %}
            
            <input type="text" id="title" name="title" placeholder="Title" value="{{ book_details.title if book_details }}" required>
            <input type="text" id="subtitle" name="subtitle" placeholder="Subtitle" value="{{ book_details.subtitle if book_details }}">
            <input type="text" id="author" name="author" placeholder="Author" value="{{ book_details.author if book_details }}" required>
            <input type="text" id="isbn" name="isbn" placeholder="ISBN" value="{{ book_details.isbn if book_details }}">
            <input type="text" id="publisher" name="publisher" placeholder="Publisher" value="{{ book_details.publisher if book_details }}">
            <input type="text" id="genre" name="genre" placeholder="Genre" value="{{ book_details.genre if book_details }}">
            <input type="text" id="year" name="year" placeholder="Year" value="{{ book_details.year if book_details }}">
            <input type="text" id="page_count" name="page_count" placeholder="Page Count" value="{{ book_details.page_count if book_details }}">
            <input type="text" id="description" name="description" placeholder="Enter description here..." value="{{ book_details.description if book_details }}">

            <input type="hidden" name="existing_cover_url" value="{{ book_details.local_cover_url if book_details and book_details.local_cover_url else '' }}">
            
            <div class="image-upload-section">
                <div id="cover-preview" class="cover-preview">
                    {% if book_details and book_details.thumbnail_url %}
                    <img src="{{ book_details.thumbnail_url }}" alt="Book cover" class="thumbnail-preview">
                    {% endif %}
                </div>
                <label for="image">Upload Your Own Book Cover (Optional)</label>
                <input type="file" id="image" name="image" accept="image/*">
            </div>

            <button type="submit" name="submit_book" class="add-book-link" id="add-book-link">Add Book</button>
        </form>
    </div>

    <script src="{{ url_for('static', filename='add_book.js') }}"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>